machine:
    environment:
        Vc_ROOT: /home/ubuntu/Vc_install
        BOOST_ROOT: /home/ubuntu/boost_install
        HPX_ROOT: /home/ubuntu/hpx_install
        AutoTuneTMP_ROOT: /home/ubuntu/AutoTuneTMP
        MatrixMultiplicationHPX_ROOT: /home/ubuntu/MatrixMultiplicationHPX_install
        JEMALLOC_ROOT: /home/ubuntu/jemalloc_install

dependencies:
    pre:
        - cat /proc/cpuinfo
        - if [[ ! -e deb_cache ]]; then sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test; sudo apt-get update; mkdir deb_cache; cd deb_cache; sudo apt-get download -y cpp-7 g++-7 gcc-7 gcc-7-base libasan4 libcc1-0 libcilkrts5 libgcc-7-dev libhwloc-dev libhwloc-plugins libhwloc5 libisl15 liblsan0 libmpx2 libpci-dev libstdc++-7-dev libubsan0 ocl-icd-libopencl1 libatomic1 libgcc1 libgomp1 libitm1 libmpfr4 libquadmath0 libstdc++6 libtsan0; fi
        - cd deb_cache; sudo dpkg -i *.deb
        - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 10
        - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-7 10
        - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 20
        - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-7 20
    cache_directories:
        - "/home/ubuntu/MatrixMultiplicationHPX/Vc"
        - "/home/ubuntu/MatrixMultiplicationHPX/hpx"
        - "/home/ubuntu/MatrixMultiplicationHPX/AutoTuneTMP"
        - "/home/ubuntu/MatrixMultiplicationHPX/boost"
        - "/home/ubuntu/MatrixMultiplicationHPX/cmake"
        - "/home/ubuntu/MatrixMultiplicationHPX/deb_cache"
compile:
    override:
        - ./build-all.sh circle
test:
    override:
        - export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/home/ubuntu/MatrixMultiplicationHPX/boost_install/lib:/home/ubuntu/MatrixMultiplicationHPX/hpx_install/lib:/home/ubuntu/MatrixMultiplicationHPX/Vc_install/lib
        - ./build_RelWithDebInfo/boost_tests --log_level=test_suite

